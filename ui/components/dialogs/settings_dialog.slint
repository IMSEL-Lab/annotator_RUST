import { MaterialPalette } from "../../material/ui/styling/material_palette.slint";
import { MaterialTypography } from "../../material/ui/styling/material_typography.slint";
import { MaterialText } from "../../material/ui/components/material_text.slint";
import { FilledButton } from "../../material/ui/components/filled_button.slint";
import { TextButton } from "../../material/ui/components/text_button.slint";
import { CheckBox, CheckState } from "../../material/ui/components/check_box.slint";
import { VerticalBox, HorizontalBox, ComboBox } from "std-widgets.slint";

component SettingsCheckBox inherits HorizontalLayout {
    in property <string> text;
    in-out property <bool> checked;
    spacing: 8px;
    
    CheckBox {
         check_state: root.checked ? CheckState.checked : CheckState.unchecked;
         checked_state_changed(s) => { root.checked = s == CheckState.checked; }
    }
    MaterialText {
         text: root.text;
         vertical_alignment: center;
         style: MaterialTypography.body_medium;
         color: MaterialPalette.on_surface;
    }
}

// Settings dialog component
export component SettingsDialog {
    in-out property <bool> show-dialog: false;

    // Settings values
    in-out property <string> theme-selection: "dark";
    in-out property <bool> enable-points: true;
    in-out property <bool> enable-bboxes: true;
    in-out property <bool> enable-polygons: true;
    in-out property <bool> randomize-dataset: false;
    in-out property <int> autosave-interval: 5;

    callback apply-settings();
    callback cancel();

    // Modal overlay
    if root.show-dialog: Rectangle {
        width: 100%;
        height: 100%;
        background: MaterialPalette.scrim.with_alpha(0.5);

        // Dialog box
        Rectangle {
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            width: 500px;
            height: 480px;
            background: MaterialPalette.surface_container;
            border_radius: 28px; // Material 3 Dialog Radius

            VerticalBox {
                padding: 24px;
                spacing: 16px;

                // Title
                MaterialText {
                    text: "Settings";
                    style: MaterialTypography.headline_small;
                    color: MaterialPalette.on_surface;
                }

                Rectangle { height: 8px; }

                // Appearance Section
                VerticalBox {
                    spacing: 8px;

                    MaterialText {
                        text: "Appearance";
                        style: MaterialTypography.title_medium;
                        color: MaterialPalette.primary;
                    }

                    HorizontalBox {
                        spacing: 12px;

                        MaterialText {
                            text: "Theme:";
                            style: MaterialTypography.body_large;
                            vertical_alignment: center;
                            width: 120px;
                        }

                        ComboBox {
                            model: ["Dark", "Light"];
                            current-value: root.theme-selection == "dark" ? "Dark" : "Light";
                            selected => {
                                root.theme-selection = self.current-value == "Dark" ? "dark" : "light";
                            }
                        }
                    }
                }

                // Annotation Modes Section
                VerticalBox {
                    spacing: 8px;

                    MaterialText {
                        text: "Annotation Modes";
                        style: MaterialTypography.title_medium;
                        color: MaterialPalette.primary;
                    }

                    MaterialText {
                        text: "Enable or disable annotation types:";
                        style: MaterialTypography.body_small;
                        color: MaterialPalette.on_surface_variant;
                    }

                    SettingsCheckBox {
                        text: "Enable Center Points (C key)";
                        checked <=> root.enable-points;
                    }

                    SettingsCheckBox {
                        text: "Enable Bounding Boxes (B key)";
                        checked <=> root.enable-bboxes;
                    }

                    SettingsCheckBox {
                        text: "Enable Polygons (S key)";
                        checked <=> root.enable-polygons;
                    }
                }

                // Dataset Section
                VerticalBox {
                    spacing: 8px;

                    MaterialText {
                        text: "Dataset";
                        style: MaterialTypography.title_medium;
                        color: MaterialPalette.primary;
                    }

                    SettingsCheckBox {
                        text: "Randomize dataset order on load";
                        checked <=> root.randomize-dataset;
                    }

                    HorizontalBox {
                        spacing: 12px;

                        MaterialText {
                            text: "Auto-save interval:";
                            style: MaterialTypography.body_large;
                            vertical_alignment: center;
                            width: 120px;
                        }

                        MaterialText {
                            text: root.autosave-interval + " seconds";
                            style: MaterialTypography.body_medium;
                            vertical_alignment: center;
                        }
                    }
                }

                // Spacer
                Rectangle { }

                // Buttons
                HorizontalBox {
                    spacing: 8px;
                    alignment: end;

                    TextButton {
                        text: "Cancel";
                        clicked => { root.cancel(); }
                    }

                    FilledButton {
                        text: "Apply";
                        clicked => { root.apply-settings(); }
                    }
                }
            }
        }
    }
}
