// ============================================================================
// BOTTOM BAR COMPONENT
// ============================================================================
// Status bar with fixed-width sections and navigation controls

import { MaterialPalette } from "../material/ui/styling/material_palette.slint";
import { MaterialTypography } from "../material/ui/styling/material_typography.slint";
import { MaterialStyleMetrics } from "../material/ui/styling/material_style_metrics.slint";
import { MaterialText } from "../material/ui/components/material_text.slint";
import { IconButton } from "../material/ui/components/icon_button.slint";
import { Icon } from "../material/ui/components/icon.slint";
import { Icons } from "../material/ui/icons/icons.slint";
import { VerticalDivider } from "../material/ui/components/divider.slint";

export component BottomBar {
    // ========================================================================
    // PROPERTIES
    // ========================================================================
    in property <string> dataset-position: "";
    in property <string> current-image-name: "";
    in property <bool> frame-completed: false;
    in property <string> status-text: "";
    in property <string> current-tool: "";
    in property <int> current-class: 1;

    // ========================================================================
    // LAYOUT
    // ========================================================================
    min-height: 32px;

    Rectangle {
        background: MaterialPalette.surface-container;

        HorizontalLayout {
            width: 100%;
            padding-top: 6px;
            padding-bottom: 6px;
            padding-left: 12px;
            padding-right: 12px;
            spacing: 12px;


            // ================================================================
            // DATASET POSITION (Fixed width)
            // ================================================================
            Rectangle {
                width: 80px;

                MaterialText {
                    text: root.dataset-position == "" ? "No dataset" : root.dataset-position;
                    style: MaterialTypography.label-small;
                    color: MaterialPalette.on-surface-variant;
                    vertical-alignment: center;
                    horizontal-alignment: center;
                }
            }

            VerticalDivider { }

            // ================================================================
            // IMAGE NAME (Fixed width with ellipsis)
            // ================================================================
            Rectangle {
                width: 200px;

                HorizontalLayout {
                    spacing: 8px;

                    MaterialText {
                        text: root.current-image-name;
                        style: MaterialTypography.label-small;
                        color: MaterialPalette.on-surface-variant;
                        vertical-alignment: center;
                        overflow: elide;
                    }

                    if root.frame-completed: Icon {
                        source: Icons.check;
                        colorize: MaterialPalette.primary;
                        width: 16px;
                    }
                }
            }

            VerticalDivider { }

            // ================================================================
            // STATUS TEXT (Flexible width with overflow handling)
            // ================================================================
            Rectangle {
                horizontal-stretch: 1;
                min-width: 100px;  // Ensure minimum space

                MaterialText {
                    text: root.status-text;
                    style: MaterialTypography.label-medium;
                    color: MaterialPalette.on-surface;
                    vertical-alignment: center;
                    overflow: elide;       // Add ellipsis (...) when text is too long
                    wrap: TextWrap.no-wrap; // Keep to a single line
                    width: 100%;           // Take full width of container
                }
            }

            VerticalDivider { }

            // ================================================================
            // TOOL INFO (Fixed width)
            // ================================================================
            Rectangle {
                width: 150px;

                MaterialText {
                    text: "Tool: " + root.current-tool;
                    style: MaterialTypography.label-small;
                    color: root.current-tool == "Neutral" ? MaterialPalette.outline : MaterialPalette.primary;
                    vertical-alignment: center;
                }
            }

            VerticalDivider { }

            // ================================================================
            // CLASS INFO (Fixed width)
            // ================================================================
            Rectangle {
                width: 80px;

                MaterialText {
                    text: "Class: " + root.current-class;
                    style: MaterialTypography.label-small;
                    color: MaterialPalette.tertiary;
                    vertical-alignment: center;
                }
            }
        }
    }
}
